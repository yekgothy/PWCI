<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Post - World Cup Hub</title>
    <script src="https://cdn.tailwindcss.com?v=3.4.1"></script>
</head>
<body class="bg-neutral-50 text-neutral-900 font-sans min-h-screen" style="background-image: url('../public/bgFeed.png'); background-size: cover; background-position: center; background-attachment: fixed;">

    <!-- NAVBAR COMPONENT -->
    <div id="navbar"></div>

    <!-- MAIN CONTENT -->
    <main class="min-h-screen pt-16 md:pt-0">
        <div class="flex max-w-7xl mx-auto">
            
            <!-- LEFT SIDEBAR -->
            <div class="w-72 fixed left-0 top-0 h-screen overflow-y-auto hidden md:block" id="sidebarFeed1"></div>
            
            <!-- CENTER CONTENT -->
            <div class="flex-1 md:ml-72 md:mr-72 px-6 py-8">
                <div class="max-w-2xl mx-auto">
                    
                    <!-- Header -->
                    <div class="mb-8">
                        <h1 class="text-4xl font-extrabold text-neutral-900 tracking-tight">Crear Nueva Publicación</h1>
                        <p class="text-neutral-600 mt-2">Tu voz suma al análisis mundialista. Dale el toque que distingue a World Cup Hub.</p>
                    </div>

                    <!-- Create Post Form -->
                    <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-neutral-200/80 p-6 md:p-8">
                        <form id="createPostForm" class="space-y-7">

                            <div class="bg-gradient-to-r from-zinc-900 via-zinc-800 to-zinc-900 text-white rounded-xl p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-5 shadow-lg shadow-zinc-900/20">
                                <div class="flex items-start gap-3">
                                    <div class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6l4 2"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3C7.03 3 3 7.03 3 12s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9z"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm uppercase tracking-[0.2em] text-white/60">Guía rápida</p>
                                        <h2 class="text-lg font-semibold">Publica con propósito</h2>
                                        <p class="text-sm text-white/70 mt-1">Elige bien tu categoría, suma contexto al contenido y asegúrate de incluir imágenes de alta calidad cuando aporten valor.</p>
                                    </div>
                                </div>
                                <ul class="text-sm text-white/70 space-y-1">
                                    <li>• Sé claro y directo (mín. 20 caracteres).</li>
                                    <li>• Usa la imagen solo si refuerza tu historia.</li>
                                    <li>• Respeta las reglas de la comunidad.</li>
                                </ul>
                            </div>

                            <!-- Post Title -->
                            <div>
                                <label for="title" class="block text-sm font-medium text-neutral-700 mb-2">
                                    Título de la publicación *
                                </label>
                                <input 
                                    type="text" 
                                    id="title" 
                                    name="title" 
                                    class="w-full px-4 py-3 border border-neutral-300 rounded-xl bg-white/90 focus:outline-none focus:ring-2 focus:ring-black focus:border-black transition-all" 
                                    placeholder="¿Qué quieres compartir sobre el Mundial?"
                                    required
                                    minlength="5"
                                    maxlength="200"
                                >
                                <p class="text-xs text-neutral-500 mt-1">Mínimo 5 caracteres</p>
                            </div>

                            <!-- Category Selection -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                                <div>
                                    <label for="category" class="block text-sm font-medium text-neutral-700 mb-2">
                                        Categoría *
                                    </label>
                                    <select 
                                        id="category" 
                                        name="category" 
                                        class="w-full px-4 py-3 border border-neutral-300 rounded-xl bg-white/90 focus:outline-none focus:ring-2 focus:ring-black focus:border-black transition-all" 
                                        required
                                    >
                                        <option value="">Cargando categorías...</option>
                                    </select>
                                </div>

                                <!-- World Cup Selection -->
                                <div>
                                    <label for="mundial" class="block text-sm font-medium text-neutral-700 mb-2">
                                        Mundial *
                                    </label>
                                    <select 
                                        id="mundial" 
                                        name="mundial" 
                                        class="w-full px-4 py-3 border border-neutral-300 rounded-xl bg-white/90 focus:outline-none focus:ring-2 focus:ring-black focus:border-black transition-all" 
                                        required
                                    >
                                        <option value="">Cargando mundiales...</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Post Content -->
                            <div>
                                <label for="content" class="block text-sm font-medium text-neutral-700 mb-2">
                                    Contenido *
                                </label>
                                <textarea 
                                    id="content" 
                                    name="content" 
                                    rows="8" 
                                    class="w-full px-4 py-3 border border-neutral-300 rounded-xl bg-white/90 focus:outline-none focus:ring-2 focus:ring-black focus:border-black resize-none transition-all" 
                                    placeholder="Escribe tu publicación aquí... Comparte tu análisis, opinión o noticia sobre el Mundial."
                                    required
                                    minlength="20"
                                    maxlength="2000"
                                ></textarea>
                                <p id="charCounter" class="text-xs text-neutral-500 mt-2 flex justify-between items-center gap-4">
                                    <span class="text-neutral-500/80">Tip: usa subtítulos o listas si cuentas una historia larga.</span>
                                    <span id="charCountRemaining">2000 caracteres restantes</span>
                                </p>
                            </div>

                            <!-- Image Upload (BLOB) -->
                            <div>
                                <label for="imageFile" class="block text-sm font-medium text-neutral-700 mb-2">
                                    Subir imagen (opcional)
                                </label>
                                <div class="flex items-center justify-center w-full">
                                    <label for="imageFile" class="flex flex-col items-center justify-center w-full h-32 border border-dashed border-neutral-300 rounded-xl cursor-pointer bg-neutral-100/60 hover:bg-white transition-all">
                                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                                            <svg class="w-8 h-8 mb-3 text-neutral-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                            </svg>
                                            <p class="mb-2 text-sm text-neutral-600"><span class="font-semibold">Click para subir</span> o arrastra aquí</p>
                                            <p class="text-xs text-neutral-500">PNG, JPG, GIF o WebP (MAX. 5MB)</p>
                                        </div>
                                        <input 
                                            id="imageFile" 
                                            name="imageFile"
                                            type="file" 
                                            class="hidden" 
                                            accept="image/jpeg,image/png,image/gif,image/webp"
                                        />
                                    </label>
                                </div>
                                
                                <!-- Image Preview -->
                                <div id="imagePreview" class="mt-4 hidden">
                                    <div class="relative rounded-xl overflow-hidden border border-neutral-200">
                                        <img id="previewImage" src="" alt="Preview" class="w-full h-64 object-cover">
                                        <button 
                                            type="button" 
                                            id="removeImage"
                                            class="absolute top-3 right-3 bg-black/80 text-white p-2 rounded-full hover:bg-black transition-colors shadow-lg"
                                        >
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                    <p id="imageInfo" class="text-xs text-neutral-500 mt-2"></p>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex flex-col sm:flex-row gap-3 pt-5 border-t border-neutral-200">
                                <a 
                                    href="feed.html" 
                                    class="flex-1 px-6 py-3 border border-neutral-300 text-neutral-700 rounded-xl hover:bg-white transition-all text-center font-semibold"
                                >
                                    Cancelar
                                </a>
                                <button 
                                    type="submit" 
                                    id="submitBtn"
                                    class="flex-1 px-6 py-3 bg-black text-white rounded-xl hover:bg-zinc-900 transition-all text-center font-semibold shadow-md shadow-black/20"
                                >
                                    Publicar
                                </button>
                            </div>

                        </form>
                    </div>

                </div>
            </div>
            
            <!-- RIGHT SIDEBAR -->
            <div class="w-72 fixed right-0 top-0 h-screen overflow-y-auto hidden lg:block" id="sidebarFeed2"></div>

        </div>
    </main>

    <!-- Scripts -->
    <script src="../controllers/api-client.js"></script>
    <script src="../controllers/auth.js"></script>
    <script>protectPage();</script>
    <script src="../controllers/avatar-utils.js"></script>
    <script src="../controllers/session.js"></script>
    <script src="../controllers/countdown.js"></script>
    <script src="../controllers/createPost.js"></script>
    <script src="../controllers/sidebar.js"></script>
    <script src="../controllers/officialNews.js"></script>
    <script>
        // Load components
        Promise.all([
            fetch('../components/navbar.html').then(response => response.text()),
            fetch('../components/sidebarFeed1.html').then(response => response.text()),
            fetch('../components/sidebarFeed2.html').then(response => response.text())
        ]).then(([navbarHTML, sidebar1HTML, sidebar2HTML]) => {
            document.getElementById('navbar').innerHTML = navbarHTML;
            document.getElementById('sidebarFeed1').innerHTML = sidebar1HTML;
            document.getElementById('sidebarFeed2').innerHTML = sidebar2HTML;
            
            if (typeof initSidebar === 'function') {
                initSidebar();
            }

            if (window.PWCI && window.PWCI.session) {
                window.PWCI.session.refreshUI();
            }

            // Update active menu item for this page
            updateActiveMenuItem();
            
            // Initialize navbar functionality
            initializeNavbar();
            if (window.PWCI && window.PWCI.countdown) {
                window.PWCI.countdown.init();
            }
        });

        function updateActiveMenuItem() {
            // Remove active class from all menu items
            const menuItems = document.querySelectorAll('#sidebarFeed1 nav ul li a');
            menuItems.forEach(item => {
                item.classList.remove('bg-zinc-800', 'text-white', 'font-semibold');
                item.classList.add('text-zinc-400');
            });
            
            // Add active class to "Crear Post"
            const createPostLink = Array.from(menuItems).find(item => 
                item.getAttribute('href') === '../pages/createPost.html'
            );
            if (createPostLink) {
                createPostLink.classList.remove('text-zinc-400');
                createPostLink.classList.add('bg-zinc-800', 'text-white', 'font-semibold');
            }
        }

        function initializeNavbar() {
            const menuButton = document.getElementById('menuButton');
            const sidebarMenu = document.getElementById('sidebarMenu');
            const closeMenuButton = document.getElementById('closeMenuButton');
            const menuOverlay = document.getElementById('menuOverlay');

            if (menuButton && sidebarMenu) {
                menuButton.addEventListener('click', () => {
                    sidebarMenu.classList.remove('hidden');
                });

                if (closeMenuButton) {
                    closeMenuButton.addEventListener('click', () => {
                        sidebarMenu.classList.add('hidden');
                    });
                }

                if (menuOverlay) {
                    menuOverlay.addEventListener('click', () => {
                        sidebarMenu.classList.add('hidden');
                    });
                }
            }
        }

    </script>

</body>
</html>
